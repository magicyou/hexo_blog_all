<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>PHP常用的方法集锦（持续更新） | MagicYou</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.3.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">PHP常用的方法集锦（持续更新）</h1><a id="logo" href="/.">MagicYou</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">PHP常用的方法集锦（持续更新）</h1><div class="post-meta">Feb 3, 2018<span> | </span><span class="category"><a href="/categories/PHP/">PHP</a></span></div><div class="post-content"><p>开发中一个项目又一个项目，积累一下常用方法，方便查阅<br><a id="more"></a></p>
<ul>
<li>获取头部信息</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取头部信息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  string $name [参数名字]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string       [返回对应参数的值]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHeader</span><span class="params">($name=<span class="string">''</span>)</span></span>&#123;</span><br><span class="line">	$header = [];</span><br><span class="line">    <span class="keyword">if</span> (function_exists(<span class="string">'apache_request_headers'</span>) &amp;&amp; $result = apache_request_headers()) &#123;</span><br><span class="line">        $header = $result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>($name = <span class="string">'Authorization'</span>)&#123;</span><br><span class="line">            $name = <span class="string">'authorization'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $server = $_SERVER;</span><br><span class="line">        <span class="keyword">foreach</span> ($server <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">0</span> === strpos($key, <span class="string">'HTTP_'</span>)) &#123;</span><br><span class="line">                $key          = str_replace(<span class="string">'_'</span>, <span class="string">'-'</span>, strtolower(substr($key, <span class="number">5</span>)));</span><br><span class="line">                $header[$key] = $val;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($server[<span class="string">'CONTENT_TYPE'</span>])) &#123;</span><br><span class="line">            $header[<span class="string">'content-type'</span>] = $server[<span class="string">'CONTENT_TYPE'</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($server[<span class="string">'CONTENT_LENGTH'</span>])) &#123;</span><br><span class="line">            $header[<span class="string">'content-length'</span>] = $server[<span class="string">'CONTENT_LENGTH'</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $header[$name]?$header[$name]:<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>二维数组排序</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 二维数组排序</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $arr 二维数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $keys 排序键值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $type 排序方式 asc正序 desc倒</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">array_sort</span><span class="params">($arr, $keys, $type = <span class="string">'asc'</span>)</span></span>&#123;</span><br><span class="line">    $keysvalue = $new_array = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">foreach</span> ($arr <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">    	$keysvalue[$k] = $v[$keys];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ($type == <span class="string">'asc'</span>) &#123;</span><br><span class="line">   		asort($keysvalue);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        arsort($keysvalue);</span><br><span class="line">    &#125;</span><br><span class="line">    reset($keysvalue);</span><br><span class="line">    <span class="keyword">foreach</span> ($keysvalue <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">    	$new_array[$k] = $arr[$k];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $new_array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>获取用户token</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 获取用户token</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_user_token</span><span class="params">($user_id)</span> </span>&#123;</span><br><span class="line">       $token = <span class="keyword">new</span> \Org\Gamegos\jwt\src\Token();</span><br><span class="line">       $token-&gt;setClaim(<span class="string">'user_id'</span>, $user_id); <span class="comment">// alternatively you can use $token-&gt;setSubject('someone@example.com') method</span></span><br><span class="line">       $token-&gt;setClaim(<span class="string">'exp'</span>, time() + C(<span class="string">'jwt_time'</span>));</span><br><span class="line">       $encoder = <span class="keyword">new</span> \Org\Gamegos\jwt\src\Encoder();</span><br><span class="line">       $encoder-&gt;encode($token, C(<span class="string">'jwt_key'</span>), C(<span class="string">'jwt_alg'</span>));</span><br><span class="line">       <span class="keyword">return</span> $token-&gt;getJWT();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>数组随机指定个数抽取元素</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数组随机指定个数抽取元素</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $arr 数组</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $keys 指定个数</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">array_rand_to</span><span class="params">($arr, $num)</span></span>&#123;</span><br><span class="line">    $ran_arr = array_rand($arr, $num);</span><br><span class="line">    $arr_new = [];</span><br><span class="line">    <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; count($ran_arr); $i++) &#123;</span><br><span class="line">    	array_push($arr_new, $arr[$ran_arr[$i]]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $arr_new;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>php验证身份证号码是否正确函数</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * php验证身份证号码是否正确函数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> string $id 身份证号</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_idcard</span><span class="params">($id)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $id = strtoupper($id);</span><br><span class="line">    $regx = <span class="string">"/(^\d&#123;15&#125;$)|(^\d&#123;17&#125;([0-9]|X)$)/"</span>;</span><br><span class="line">    $arr_split = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">if</span>(!preg_match($regx, $id))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">15</span>==strlen($id)) <span class="comment">//检查15位</span></span><br><span class="line">    &#123;</span><br><span class="line">        $regx = <span class="string">"/^(\d&#123;6&#125;)+(\d&#123;2&#125;)+(\d&#123;2&#125;)+(\d&#123;2&#125;)+(\d&#123;3&#125;)$/"</span>;</span><br><span class="line"></span><br><span class="line">        @preg_match($regx, $id, $arr_split);</span><br><span class="line">        <span class="comment">//检查生日日期是否正确</span></span><br><span class="line">        $dtm_birth = <span class="string">"19"</span>.$arr_split[<span class="number">2</span>] . <span class="string">'/'</span> . $arr_split[<span class="number">3</span>]. <span class="string">'/'</span> .$arr_split[<span class="number">4</span>];</span><br><span class="line">        <span class="keyword">if</span>(!strtotime($dtm_birth))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>      <span class="comment">//检查18位</span></span><br><span class="line">    &#123;</span><br><span class="line">        $regx = <span class="string">"/^(\d&#123;6&#125;)+(\d&#123;4&#125;)+(\d&#123;2&#125;)+(\d&#123;2&#125;)+(\d&#123;3&#125;)([0-9]|X)$/"</span>;</span><br><span class="line">        @preg_match($regx, $id, $arr_split);</span><br><span class="line">        $dtm_birth = $arr_split[<span class="number">2</span>] . <span class="string">'/'</span> . $arr_split[<span class="number">3</span>]. <span class="string">'/'</span> .$arr_split[<span class="number">4</span>];</span><br><span class="line">        <span class="keyword">if</span>(!strtotime($dtm_birth)) <span class="comment">//检查生日日期是否正确</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//检验18位身份证的校验码是否正确。</span></span><br><span class="line">            <span class="comment">//校验位按照ISO 7064:1983.MOD 11-2的规定生成，X可以认为是数字10。</span></span><br><span class="line">            $arr_int = <span class="keyword">array</span>(<span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>);</span><br><span class="line">            $arr_ch = <span class="keyword">array</span>(<span class="string">'1'</span>, <span class="string">'0'</span>, <span class="string">'X'</span>, <span class="string">'9'</span>, <span class="string">'8'</span>, <span class="string">'7'</span>, <span class="string">'6'</span>, <span class="string">'5'</span>, <span class="string">'4'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>);</span><br><span class="line">            $sign = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; <span class="number">17</span>; $i++ )</span><br><span class="line">            &#123;</span><br><span class="line">                $b = (int) $id&#123;$i&#125;;</span><br><span class="line">                $w = $arr_int[$i];</span><br><span class="line">                $sign += $b * $w;</span><br><span class="line">            &#125;</span><br><span class="line">            $n = $sign % <span class="number">11</span>;</span><br><span class="line">            $val_num = $arr_ch[$n];</span><br><span class="line">            <span class="keyword">if</span> ($val_num != substr($id,<span class="number">17</span>, <span class="number">1</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">FALSE</span>;</span><br><span class="line">            &#125; <span class="comment">//phpfensi.com</span></span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">TRUE</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>获取当前页面完整URL地址</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取当前页面完整URL地址</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_url</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//$sys_protocal = isset($_SERVER['SERVER_PORT']) &amp;&amp; $_SERVER['SERVER_PORT'] == '443' ? 'https://' : 'http://';</span></span><br><span class="line">    $php_self   = $_SERVER[<span class="string">'PHP_SELF'</span>] ? $_SERVER[<span class="string">'PHP_SELF'</span>] : $_SERVER[<span class="string">'SCRIPT_NAME'</span>];</span><br><span class="line">    $path_info  = <span class="keyword">isset</span>($_SERVER[<span class="string">'PATH_INFO'</span>]) ? $_SERVER[<span class="string">'PATH_INFO'</span>] : <span class="string">''</span>;</span><br><span class="line">    $relate_url = <span class="keyword">isset</span>($_SERVER[<span class="string">'REQUEST_URI'</span>]) ? $_SERVER[<span class="string">'REQUEST_URI'</span>] : $php_self . (<span class="keyword">isset</span>($_SERVER[<span class="string">'QUERY_STRING'</span>]) ? <span class="string">'?'</span> . $_SERVER[<span class="string">'QUERY_STRING'</span>] : $path_info);</span><br><span class="line">    <span class="keyword">return</span> $relate_url;</span><br><span class="line">    <span class="comment">//return $sys_protocal . (isset($_SERVER['HTTP_HOST']) ? $_SERVER['HTTP_HOST'] : '') . $relate_url;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>请求接口两种方式</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * GET方式请求接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  [String] $url [curl地址]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> [返回结果数据]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl_get</span><span class="params">($url)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    $curl = curl_init();</span><br><span class="line">    <span class="comment">// 设置抓取的url</span></span><br><span class="line">    curl_setopt($curl, CURLOPT_URL, $url);</span><br><span class="line">    <span class="comment">// 设置头文件的信息作为数据流输出</span></span><br><span class="line">    curl_setopt($curl, CURLOPT_HEADER, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// 设置获取的信息以文件流的形式返回，而不是直接输出。</span></span><br><span class="line">    curl_setopt($curl, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 执行命令</span></span><br><span class="line">    $data = curl_exec($curl);</span><br><span class="line">    <span class="comment">// 关闭URL请求</span></span><br><span class="line">    curl_close($curl);</span><br><span class="line">    <span class="comment">// 返回获得的数据</span></span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * POST方式请求接口</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  [String] $url   [curl地址]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span>  [array]  $param [curl参数数组]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> [返回结果数据]</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curl_post</span><span class="params">($url, $param)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 初始化</span></span><br><span class="line">    $curl = curl_init();</span><br><span class="line">    <span class="comment">// 设置抓取的url</span></span><br><span class="line">    curl_setopt($curl, CURLOPT_URL, $url);</span><br><span class="line">    <span class="comment">// 设置头文件的信息作为数据流输出</span></span><br><span class="line">    curl_setopt($curl, CURLOPT_HEADER, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 设置获取的信息以文件流的形式返回，而不是直接输出。</span></span><br><span class="line">    curl_setopt($curl, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 设置post方式提交</span></span><br><span class="line">    curl_setopt($curl, CURLOPT_POST, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// 设置post数据</span></span><br><span class="line">    curl_setopt($curl, CURLOPT_POSTFIELDS, json_encode($param));</span><br><span class="line">    <span class="comment">// 执行命令</span></span><br><span class="line">    $data = curl_exec($curl);</span><br><span class="line">    <span class="comment">// 关闭URL请求</span></span><br><span class="line">    curl_close($curl);</span><br><span class="line">    <span class="comment">// 返回获得的数据</span></span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>获取图片的Base64编码(不支持url)</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取图片的Base64编码(不支持url)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> $img_file [传入本地图片地址]</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">img_to_base64</span><span class="params">($file)</span> </span>&#123;</span><br><span class="line">    $code = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">if</span> (file_exists($file)) &#123;</span><br><span class="line">        $info = getimagesize($file); <span class="comment">// 取得图片的大小，类型等</span></span><br><span class="line">        <span class="comment">//echo '&lt;pre&gt;' . print_r($info, true) . '&lt;/pre&gt;&lt;br&gt;';</span></span><br><span class="line"></span><br><span class="line">        $fp = fopen($file, <span class="string">"r"</span>); <span class="comment">// 图片是否可读权限</span></span><br><span class="line">        <span class="keyword">if</span> ($fp) &#123;</span><br><span class="line">            $type = <span class="string">''</span>;</span><br><span class="line">            $size = filesize($file);</span><br><span class="line">            $content = fread($fp, $size);</span><br><span class="line">            $encode = chunk_split(base64_encode($content)); <span class="comment">// base64编码</span></span><br><span class="line">            <span class="keyword">switch</span> ($info[<span class="number">2</span>]) &#123;</span><br><span class="line">                <span class="comment">//判读图片类型</span></span><br><span class="line">                <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                    $type = <span class="string">"gif"</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                    $type = <span class="string">"jpg"</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                    $type = <span class="string">"png"</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $code = <span class="string">'data:image/'</span> . $type . <span class="string">';base64,'</span> . $encode; <span class="comment">//合成图片的base64编码</span></span><br><span class="line">        &#125;</span><br><span class="line">        fclose($fp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $code; <span class="comment">//返回图片的base64</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="tags"><a href="/tags/PHP/">PHP</a></div><div class="post-nav"><a class="pre" href="/2018/03/02/百度地图聚合折腾/">百度地图聚合折腾</a><a class="next" href="/2018/01/23/使用rem做单位开发移动端/">简单粗暴的使用rem做单位开发移动端</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://blog.magicyou.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MacOS/">MacOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/CSS3/" style="font-size: 15px;">CSS3</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/微信小程序/" style="font-size: 15px;">微信小程序</a> <a href="/tags/Centos/" style="font-size: 15px;">Centos</a> <a href="/tags/other/" style="font-size: 15px;">other</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/scrapy/" style="font-size: 15px;">scrapy</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Apache/" style="font-size: 15px;">Apache</a> <a href="/tags/MacOS/" style="font-size: 15px;">MacOS</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/HTML/" style="font-size: 15px;">HTML</a> <a href="/tags/uni-app/" style="font-size: 15px;">uni-app</a> <a href="/tags/微信小程序/" style="font-size: 15px;">微信小程序'</a> <a href="/tags/canvas/" style="font-size: 15px;">canvas</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/09/03/环形温度调节实现/">环形温度调节实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/03/ vue-组件封装中之slot插槽使用/">vue---组件封装中之slot插槽使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/03/PHP获取微信小程序码/">微信小程序---PHP获取微信小程序码</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/03/微信小程序合成海报/">微信小程序---合成海报分享到朋友圈</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/24/单点登录配置 记录/">配置webgate拦截跳转到ldap登录页实现单点登录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/23/一次环境升级记录/">一次lnmp环境升级记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/03/yum源的代理设置及修改/">yum源的代理设置及修改</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/脚本微博登录自动发微博并返回cookie/">脚本微博登录自动发微博并返回cookie</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/scrapy爬虫之初次尝试/">scrapy爬虫之初次尝试</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/安装python的crypto模块/">安装python的crypto模块</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://hexo.io" title="Hexo" target="_blank">Hexo</a><ul></ul><a href="http://moxfive.xyz/" title="MOxFIVE" target="_blank">MOxFIVE</a><ul></ul><a href="https://coolshell.cn/" title="左耳朵耗子的酷壳" target="_blank">左耳朵耗子的酷壳</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">MagicYou.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.3.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.3.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.3.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.3.0"></script></div></body></html>