<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>记一次python为PHP打辅助 | MagicYou</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.3.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">记一次python为PHP打辅助</h1><a id="logo" href="/.">MagicYou</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">记一次python为PHP打辅助</h1><div class="post-meta">May 5, 2018<span> | </span><span class="category"><a href="/categories/Python/">Python</a></span></div><div class="post-content"><ul>
<li><p>项目结构：B/S结构，web端，自然是PHP主控；</p>
</li>
<li><p>问题场景：根据相应的条件，实时生成csv文件并下载。文件很大的时候，客户点击导出就一直在等，看着加载一直在打圈圈，大一点的文件三分钟也是常见，时间长了干脆请求超时，下载失败，体验极差；</p>
</li>
<li><p>解决办法：做成离线任务，用户点击下载之后，不再理会，在另一个面板查看文件是否已经生成，生成就可以下载。</p>
</li>
</ul>
<a id="more"></a>
<h3 id="研究一下php怎样做离线任务"><a href="#研究一下php怎样做离线任务" class="headerlink" title="研究一下php怎样做离线任务"></a>研究一下php怎样做离线任务</h3><p>找到两个相对有代表性的博文：</p>
<ol>
<li><p><a href="https://www.cnblogs.com/jianqingwang/p/6420602.html" target="_blank" rel="noopener">PHP工作笔记：离线执行</a></p>
</li>
<li><p><a href="http://www.thinkphp.cn/topic/21969.html" target="_blank" rel="noopener">离线下载文件（或者是离线执行任务）</a></p>
</li>
</ol>
<p>简单研究了一下，感觉不是很好用，理由如下：</p>
<ul>
<li><p>不可控，文件大了还是容易断</p>
</li>
<li><p>占用php资源，其他的页面请求开始慢下来</p>
</li>
</ul>
<p>这样的话不如想想用如何把这个处理过程交给后台，让它几自个儿玩。</p>
<p>学Python有一段时间，刚好试试”手艺”如何。</p>
<h3 id="规划流程"><a href="#规划流程" class="headerlink" title="规划流程"></a>规划流程</h3><ol>
<li>用户点击导出，php拿到用户请求，整理用户要导出的相关数据（还好这些数据都是一条sql语句查出来的），存入数据库一条记录，状态status为0，表示未处理。顺便展示一下这个表结构，python和php的互帮互助全靠这张表；</li>
</ol>
<table>
<thead>
<tr>
<th style="text-align:center">列名</th>
<th style="text-align:center">类型</th>
<th style="text-align:center">长度</th>
<th style="text-align:center">是否可为空</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">id</td>
<td style="text-align:center">int</td>
<td style="text-align:center">11</td>
<td style="text-align:center">否</td>
<td>主键，非空且唯一</td>
</tr>
<tr>
<td style="text-align:center">name</td>
<td style="text-align:center">varchar</td>
<td style="text-align:center">100</td>
<td style="text-align:center">否</td>
<td>任务名称</td>
</tr>
<tr>
<td style="text-align:center">title</td>
<td style="text-align:center">varchar</td>
<td style="text-align:center">255</td>
<td style="text-align:center">否</td>
<td>导出字段标题</td>
</tr>
<tr>
<td style="text-align:center">query</td>
<td style="text-align:center">varchar</td>
<td style="text-align:center">255</td>
<td style="text-align:center">否</td>
<td>数据库查询sql</td>
</tr>
<tr>
<td style="text-align:center">creater_name</td>
<td style="text-align:center">varchar</td>
<td style="text-align:center">100</td>
<td style="text-align:center">否</td>
<td>创建人</td>
</tr>
<tr>
<td style="text-align:center">status</td>
<td style="text-align:center">int</td>
<td style="text-align:center"></td>
<td style="text-align:center">否</td>
<td>任务状态(0:未处理,1:处理中,2,成功,3:失败)，默认为0</td>
</tr>
<tr>
<td style="text-align:center">msg</td>
<td style="text-align:center">text</td>
<td style="text-align:center"></td>
<td style="text-align:center">是</td>
<td>错误信息记录</td>
</tr>
<tr>
<td style="text-align:center">filepath</td>
<td style="text-align:center">varchar</td>
<td style="text-align:center">255</td>
<td style="text-align:center">是</td>
<td>文件地址</td>
</tr>
</tbody>
</table>
<ol>
<li>Python脚本一直在服务器运行，实时检测这张表是否有需要处理的任务（就是检测这张表是否有状态值status==1的记录）；</li>
</ol>
<ul>
<li><p>2.1 有，就将这条记录的状态status改为1（这时前端页面看到的任务状态是”处理中”）</p>
</li>
<li><p>2.2 查询数据库生成一个csv文件，成功后将文件路径放入条记录的 字段”filepath” </p>
</li>
<li><p>2.3 没有报错，就将status改为2； 有报错，就将status改为3，并将失败原因记录在msg</p>
</li>
</ul>
<ol>
<li>用户看到最新状态是”成功”，就可以点击文件下载了；状态是 “失败”，则需要进一步查看失败原因进行重新生成相关csv文件。</li>
</ol>
<h3 id="上python脚本"><a href="#上python脚本" class="headerlink" title="上python脚本"></a>上python脚本</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">import</span> psycopg2</span><br><span class="line"><span class="keyword">import</span> psycopg2.extras</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_v1_5</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># 线程数，限定数</span></span><br><span class="line">thread = <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 本地测试环境</span></span><br><span class="line">hostName = <span class="string">'http://test-web'</span></span><br><span class="line">mysql = &#123;<span class="string">'host'</span>:<span class="string">'localhost'</span>,<span class="string">'user'</span>:<span class="string">'root'</span>,<span class="string">'pwd'</span>:<span class="string">''</span>,<span class="string">'db'</span>:<span class="string">'test'</span>&#125;</span><br><span class="line">pgsql = &#123;<span class="string">'host'</span>:<span class="string">'127.0.0.1'</span>,<span class="string">'database'</span>:<span class="string">'sys'</span>,<span class="string">'user'</span>:<span class="string">'root'</span>,<span class="string">'password'</span>:<span class="string">'root'</span>,<span class="string">'port'</span>:<span class="string">'5432'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conMysql</span><span class="params">(type=<span class="string">'dict'</span>)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    mysql连接</span></span><br><span class="line"><span class="string">    :param type: 获取数据类型 默认为字典类型</span></span><br><span class="line"><span class="string">    :return:游标</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">if</span> type==<span class="string">'dict'</span>:</span><br><span class="line">        conn = pymysql.connect(mysql[<span class="string">'host'</span>],mysql[<span class="string">'user'</span>],mysql[<span class="string">'pwd'</span>],mysql[<span class="string">'db'</span>],charset=<span class="string">'utf8'</span>,cursorclass=pymysql.cursors.DictCursor)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        conn = pymysql.connect(mysql[<span class="string">'host'</span>],mysql[<span class="string">'user'</span>],mysql[<span class="string">'pwd'</span>],mysql[<span class="string">'db'</span>],charset=<span class="string">'utf8'</span>)</span><br><span class="line">    <span class="keyword">return</span> conn</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conPgsql</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    pgsql数据库连接</span></span><br><span class="line"><span class="string">    :return: 游标</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    conn = psycopg2.connect(database=pgsql[<span class="string">'database'</span>],user=pgsql[<span class="string">'user'</span>],password=pgsql[<span class="string">'password'</span>],host=pgsql[<span class="string">'host'</span>],port=pgsql[<span class="string">'port'</span>])</span><br><span class="line">    <span class="keyword">return</span> conn</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exportCsv</span><span class="params">(title,data)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    生成csv文件</span></span><br><span class="line"><span class="string">    :param title: 表头</span></span><br><span class="line"><span class="string">    :param data: 数据</span></span><br><span class="line"><span class="string">    :return: &#123;'status':任务执行状况, 'fileName':文件名&#125;</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="comment"># 数据处理</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(data)):</span><br><span class="line">        dataList = list(data[i].values())</span><br><span class="line">        dataList.insert(<span class="number">0</span>, i+<span class="number">1</span>)</span><br><span class="line">        data[i] = dataList</span><br><span class="line"></span><br><span class="line">    fileName = <span class="string">'/Public/Temp/'</span> + time.strftime(<span class="string">'%Y%m%d%H%M'</span>,time.localtime(time.time())) + <span class="string">'_'</span>+ str(int(round((time.time()) * <span class="number">1000</span>))) + <span class="string">".csv"</span></span><br><span class="line">    title = title.split(<span class="string">','</span>)</span><br><span class="line">    <span class="keyword">with</span> open(fileName,<span class="string">"w"</span>,newline=<span class="string">''</span>,encoding=<span class="string">'gb18030'</span>) <span class="keyword">as</span> csvfile:</span><br><span class="line">        writer = csv.writer(csvfile)</span><br><span class="line">        <span class="comment"># 先写入columns_name</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            writer.writerow(title)</span><br><span class="line">            writer.writerows(data)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">'status'</span>:<span class="literal">False</span>, <span class="string">'msg'</span>:<span class="string">'文件写入失败！'</span>&#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'status'</span>:<span class="literal">True</span>, <span class="string">'fileName'</span>:hostName + fileName&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getCsvDate</span><span class="params">(sql)</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    获取csv数据</span></span><br><span class="line"><span class="string">    :param sql: 获取csv数据的sql语句</span></span><br><span class="line"><span class="string">    :return:&#123;'status':sql执行状况, 'data':数据&#125;</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    conn = conPgsql()</span><br><span class="line">    cur = conn.cursor(cursor_factory=psycopg2.extras.RealDictCursor)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        cur.execute(sql)</span><br><span class="line">        rows = cur.fetchall()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        cur.close()</span><br><span class="line">        conn.close()</span><br><span class="line">        <span class="keyword">return</span> &#123;<span class="string">'status'</span>:<span class="literal">False</span>, <span class="string">'msg'</span>:<span class="string">'sql执行失败！'</span>&#125;</span><br><span class="line"></span><br><span class="line">    conn.commit()</span><br><span class="line">    cur.close()</span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">'status'</span>:<span class="literal">True</span>, <span class="string">'data'</span>:rows&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dealWork</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    任务处理</span></span><br><span class="line"><span class="string">    :return: None</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    conn = conMysql()</span><br><span class="line">    <span class="comment"># 看有没有正在进行任务是否超过限定数,超过限定数就跳跳出</span></span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    sql = <span class="string">"select count(*) count from box_download_task where status='1';"</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    re = cursor.fetchone()</span><br><span class="line">    rowsNum = re[<span class="string">'count'</span>]</span><br><span class="line">    <span class="keyword">if</span> rowsNum &gt; thread:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 看有没有未开始的任务，有的话继续进行，没有则跳出</span></span><br><span class="line">    sql = <span class="string">"select count(*) count from box_download_task where status='0' and type&lt;&gt;'4' order by id asc;"</span></span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    re = cursor.fetchone()</span><br><span class="line">    <span class="keyword">if</span> re[<span class="string">'count'</span>]==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 根据降序选择最早加入的并且未处理的任务进行处理</span></span><br><span class="line">        sql = <span class="string">"select * from box_download_task where status='0' order by id asc;"</span></span><br><span class="line">        cursor.execute(sql)</span><br><span class="line">        re = cursor.fetchone()</span><br><span class="line">        workId = re[<span class="string">'id'</span>]</span><br><span class="line">        <span class="comment"># 修改记录status为1，处理中，防止其他线程重复处理</span></span><br><span class="line">        sql = <span class="string">'update box_download_task set status="%s" where id=%d;'</span> % (<span class="string">'1'</span>,workId)</span><br><span class="line">        cursor.execute(sql)</span><br><span class="line">        conn.commit()</span><br><span class="line"></span><br><span class="line">        sql = re[<span class="string">'query'</span>]</span><br><span class="line">        title = re[<span class="string">'title'</span>]</span><br><span class="line">        <span class="comment"># 获取csv的数据</span></span><br><span class="line">        res = getCsvDate(sql)</span><br><span class="line">        <span class="keyword">if</span> res[<span class="string">'status'</span>]:</span><br><span class="line">            <span class="comment"># 导出csv</span></span><br><span class="line">            file = exportCsv(title, res[<span class="string">'data'</span>])</span><br><span class="line">            <span class="comment"># 写入文件是否成功，成功则修改status为2，失败则status为3</span></span><br><span class="line">            <span class="keyword">if</span> file[<span class="string">'status'</span>]:</span><br><span class="line">                sql = <span class="string">'update box_download_task set status="%s", filepath="%s" where id=%d;'</span> % (</span><br><span class="line">                <span class="string">'2'</span>, file[<span class="string">'fileName'</span>], workId)</span><br><span class="line">                cursor.execute(sql)</span><br><span class="line">                conn.commit()</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                sql = <span class="string">'update box_download_task set status="%s", msg="%s" where id=%d;'</span> % (<span class="string">'3'</span>, file[<span class="string">'msg'</span>], workId)</span><br><span class="line">                cursor.execute(sql)</span><br><span class="line">                conn.commit()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            sql = <span class="string">'update box_download_task set status="%s", msg="%s" where id=%d;'</span> % (<span class="string">'3'</span>, res[<span class="string">'msg'</span>], workId)</span><br><span class="line">            cursor.execute(sql)</span><br><span class="line">            conn.commit()</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    conn.close()</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 引入多线程并行快速处理</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(thread):</span><br><span class="line">            t = threading.Thread(target=dealWork, args=())</span><br><span class="line">            t.start()</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        t.join()</span><br><span class="line">        print(<span class="string">'执行了'</span>)</span><br><span class="line">        time.sleep(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>小结：</p>
<ul>
<li><p>python引入多线程，并行处理多个任务，效率不言而喻；</p>
</li>
<li><p>引用队列思想，先进先出，一个一个处理，一个不落；</p>
</li>
<li><p>python独立于php进程，不占用php运行资源；</p>
</li>
<li><p>比起以往点击下载后进行查询生成文件再下载，虽然步骤多了，但是用户体验提高了不止一点，属于优化（想想不该掉原先php的导出文件，数据大迟早要出问题）</p>
</li>
</ul>
<p>完结！</p>
</div><div class="tags"><a href="/tags/Python/">Python</a></div><div class="post-nav"><a class="pre" href="/2018/05/11/vuex的五个属性/">vuex使用方式</a><a class="next" href="/2018/05/03/20180605/">怎样一个服务器存放多个站点，分别绑定不同的域名</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://blog.magicyou.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MacOS/">MacOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/CSS3/" style="font-size: 15px;">CSS3</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/微信小程序/" style="font-size: 15px;">微信小程序</a> <a href="/tags/Centos/" style="font-size: 15px;">Centos</a> <a href="/tags/other/" style="font-size: 15px;">other</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/scrapy/" style="font-size: 15px;">scrapy</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Apache/" style="font-size: 15px;">Apache</a> <a href="/tags/MacOS/" style="font-size: 15px;">MacOS</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/HTML/" style="font-size: 15px;">HTML</a> <a href="/tags/uni-app/" style="font-size: 15px;">uni-app</a> <a href="/tags/微信小程序/" style="font-size: 15px;">微信小程序'</a> <a href="/tags/canvas/" style="font-size: 15px;">canvas</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/09/03/环形温度调节实现/">环形温度调节实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/03/ vue-组件封装中之slot插槽使用/">vue---组件封装中之slot插槽使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/03/PHP获取微信小程序码/">微信小程序---PHP获取微信小程序码</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/03/微信小程序合成海报/">微信小程序---合成海报分享到朋友圈</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/24/单点登录配置 记录/">配置webgate拦截跳转到ldap登录页实现单点登录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/23/一次环境升级记录/">一次lnmp环境升级记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/03/yum源的代理设置及修改/">yum源的代理设置及修改</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/脚本微博登录自动发微博并返回cookie/">脚本微博登录自动发微博并返回cookie</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/scrapy爬虫之初次尝试/">scrapy爬虫之初次尝试</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/安装python的crypto模块/">安装python的crypto模块</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://hexo.io" title="Hexo" target="_blank">Hexo</a><ul></ul><a href="http://moxfive.xyz/" title="MOxFIVE" target="_blank">MOxFIVE</a><ul></ul><a href="https://coolshell.cn/" title="左耳朵耗子的酷壳" target="_blank">左耳朵耗子的酷壳</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">MagicYou.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.3.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.3.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.3.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.3.0"></script></div></body></html>