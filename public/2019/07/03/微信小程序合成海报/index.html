<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>微信小程序---合成海报分享到朋友圈 | MagicYou</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.3.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">微信小程序---合成海报分享到朋友圈</h1><a id="logo" href="/.">MagicYou</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/tags/"><i class="fa fa-tag"> 标签</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">微信小程序---合成海报分享到朋友圈</h1><div class="post-meta">Jul 3, 2019<span> | </span><span class="category"><a href="/categories/前端/">前端</a></span></div><div class="post-content"><p>记录一下折腾小程序遇到的问题。小程序目前只提供了分享给朋友或者群聊，想要分享到朋友圈只能合成带小程序码的海报分享到朋友圈</p>
<a id="more"></a>
<p>本篇的小程序使用的是uni-app开发小程序，代码都是适用于uni-app的，方法和微信小程序官方差别不大，”uni.”改成”wx.”基本就可以使用。</p>
<p>合成带小程序码的海报分享到朋友圈，小程序码怎么获取看前文《PHP获取微信小程序码》，这篇文章要做的是所有图片素材已经有网络路径，当然路径是https协议的，并且在小程序后台已配置。</p>
<h4 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h4><ul>
<li><ol>
<li>合理布局，画布设置好尺寸，放在屏幕以外备用</li>
</ol>
</li>
<li><ol>
<li>wx.downloadFile()方法下载所有需要使用的图片，得到的路径为本地临时路径</li>
</ol>
</li>
<li><ol>
<li>canvas绘制海报；将图片合理绘制在海报上预设的位置</li>
</ol>
</li>
<li><ol>
<li>将canvas提取出来，获得海报本地临时路径，在弹窗中展示使用</li>
</ol>
</li>
<li><ol>
<li>点击按钮，wx.saveImageToPhotosAlbum()，使用海报本地临时路径下载到本地相册</li>
</ol>
</li>
</ul>
<h4 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h4><p>data中定义几个变量，方便下文使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">product_cover: &apos;&apos;,  // 商品图url</span><br><span class="line">screenWidth: 375 ,   // 海报宽度</span><br><span class="line">windowHeight: 665,  // 海报高度</span><br><span class="line">acode_path: null,   // 小程序码路径</span><br><span class="line">qrcode_temp: &apos;&apos;,   // 小程序码本地临时路径</span><br><span class="line">goods_temp: &apos;&apos;,		// 商品图本地临时路径</span><br><span class="line">popupShow: false,  // 是否显示海报弹窗</span><br><span class="line">maskShow: false,		// 遮罩曾是否显示</span><br><span class="line">tempFilePath: null  // 海报本地临时路径</span><br></pre></td></tr></table></figure>
<p>模板和css</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- canvas绘制海报 --&gt;</span><br><span class="line">		&lt;canvas canvas-id=&quot;myCanvas&quot; class=&quot;box-canvas&quot; style=&quot;width:375px;&quot; :style=&quot;&#123;height: windowHeight + &apos;px&apos;&#125;&quot;&gt;&lt;/canvas&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;!-- 海报弹窗模板 --&gt;</span><br><span class="line">		&lt;view class=&quot;box-mask&quot; v-if=&quot;popupShow&quot;&gt;&lt;/view&gt;</span><br><span class="line">		</span><br><span class="line">		&lt;!--  海报弹窗--&gt;</span><br><span class="line">		&lt;view class=&quot;box-poster&quot; v-if=&quot;popupShow&quot;&gt;</span><br><span class="line">			&lt;view class=&quot;btn-close iconfont iconguanbi2&quot; @click=&quot;cancelPoster&quot;&gt;&lt;/view&gt;</span><br><span class="line">			&lt;view class=&quot;canvas-box&quot;&gt;</span><br><span class="line">				&lt;image :src=&quot;tempFilePath&quot;&gt;&lt;/image&gt;</span><br><span class="line">			&lt;/view&gt;</span><br><span class="line">			&lt;button class=&quot;btn-save&quot; @click=&quot;canvasToImage&quot;&gt;下载图片&lt;/button&gt;</span><br><span class="line">		&lt;/view&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">/* 把canvas直接展示，移出到屏幕可视区域以外，方便绘制，调试的时候放在屏幕上就行 */</span><br><span class="line">.box-canvas&#123;</span><br><span class="line">		position: fixed;</span><br><span class="line">		top:100000px;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	/* 海报弹窗 */</span><br><span class="line">	.box-poster&#123;</span><br><span class="line">		position: fixed;</span><br><span class="line">		top:50%;</span><br><span class="line">		left: 50%;</span><br><span class="line">		transform: translate(-50%, -50%);</span><br><span class="line">		z-index: 101;</span><br><span class="line">		</span><br><span class="line">		.btn-close&#123;</span><br><span class="line">			position: absolute;</span><br><span class="line">			top: -25rpx;</span><br><span class="line">			right: -25rpx;</span><br><span class="line">			width: 50rpx;</span><br><span class="line">			height: 50rpx;</span><br><span class="line">			line-height: 50rpx;</span><br><span class="line">			text-align: center;</span><br><span class="line">			font-size: 40rpx;</span><br><span class="line">			background: #fff;</span><br><span class="line">			border-radius: 50%;</span><br><span class="line">			color: $uni-color-primary;</span><br><span class="line">			box-shadow: 2rpx 2rpx 10rpx $uni-color-primary;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		.canvas-box&#123;</span><br><span class="line">			width: 460rpx;</span><br><span class="line">			height: 820rpx;</span><br><span class="line">			display: inline-block;</span><br><span class="line">			image&#123;</span><br><span class="line">				width: 460rpx;</span><br><span class="line">				height: 820rpx;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		.btn-save&#123;</span><br><span class="line">			margin-top: 5px;</span><br><span class="line">			width: 460rpx;</span><br><span class="line">			height: 75rpx;</span><br><span class="line">			line-height: 75rpx;</span><br><span class="line">			background: #fa4547;</span><br><span class="line">			color: #fff;</span><br><span class="line">			font-size: 26rpx;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
<p>主要是把画布设置好尺寸，放在屏幕以外的地方</p>
<h4 id="下载所有需要使用的图片"><a href="#下载所有需要使用的图片" class="headerlink" title="下载所有需要使用的图片"></a>下载所有需要使用的图片</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/download/wx.downloadFile.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/api/network/download/wx.downloadFile.html</a></p>
<p>官方说明</p>
<p>wx.downloadFile()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DownloadTask wx.downloadFile(Object object)</span><br><span class="line">下载文件资源到本地。客户端直接发起一个 HTTPS GET 请求，返回文件的本地临时路径，单次下载允许的最大文件为 50MB。使用前请注意阅读相关说明。</span><br><span class="line"></span><br><span class="line">注意：请在服务端响应的 header 中指定合理的 Content-Type 字段，以保证客户端正确处理文件类型。</span><br><span class="line"></span><br><span class="line">示例代码</span><br><span class="line">wx.downloadFile(&#123;</span><br><span class="line">  url: &apos;https://example.com/audio/123&apos;, //仅为示例，并非真实的资源</span><br><span class="line">  success (res) &#123;</span><br><span class="line">    // 只要服务器有响应数据，就会把响应内容写入文件并进入 success 回调，业务需要自行判断是否下载到了想要的内容</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>关键源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">			 * 缓存图片</span><br><span class="line">			 * @param &#123;Object&#125; target 目标</span><br><span class="line">			 * @param &#123;Object&#125; img_url  图片网络链接</span><br><span class="line">			 */</span><br><span class="line">			cacheFile(target, img_url, func=null) &#123;</span><br><span class="line">				let _this = this;</span><br><span class="line">				wx.downloadFile(&#123;</span><br><span class="line">					url: img_url,</span><br><span class="line">					success: function(res2) &#123;</span><br><span class="line">						if (target == &apos;qrcode&apos;) &#123;</span><br><span class="line">							console.log(&apos;二维码：&apos; + res2.tempFilePath)</span><br><span class="line">							//缓存二维码</span><br><span class="line">							_this.qrcode_temp = res2.tempFilePath;</span><br><span class="line">						&#125; else if (target == &apos;portrait&apos;) &#123;</span><br><span class="line">							console.log(&apos;头像：&apos; + res2.tempFilePath)</span><br><span class="line">							//缓存二维码</span><br><span class="line">							_this.portrait_temp = res2.tempFilePath;</span><br><span class="line">						&#125; else if (target == &apos;goods&apos;) &#123;</span><br><span class="line">							console.log(&apos;商品封面：&apos; + res2.tempFilePath)</span><br><span class="line">							//缓存二维码</span><br><span class="line">							_this.goods_temp = res2.tempFilePath;</span><br><span class="line">						&#125;</span><br><span class="line">						if (func) &#123;</span><br><span class="line">							func()</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125;,</span><br><span class="line">			/**</span><br><span class="line">			 * 缓存图片</span><br><span class="line">			 * @param &#123;Object&#125; target 目标</span><br><span class="line">			 * @param &#123;Object&#125; img_url  图片网络链接</span><br><span class="line">			 * @param &#123;Object&#125; func  回调函数</span><br><span class="line">			 */</span><br><span class="line">			cacheFile(target, img_url, func=null) &#123;</span><br><span class="line">				let _this = this;</span><br><span class="line">				wx.downloadFile(&#123;</span><br><span class="line">					url: img_url,</span><br><span class="line">					success: function(res2) &#123;</span><br><span class="line">						if (target == &apos;qrcode&apos;) &#123;</span><br><span class="line">							console.log(&apos;二维码：&apos; + res2.tempFilePath)</span><br><span class="line">							_this.qrcode_temp = res2.tempFilePath;</span><br><span class="line">						&#125; else if (target == &apos;portrait&apos;) &#123;</span><br><span class="line">							console.log(&apos;头像：&apos; + res2.tempFilePath)</span><br><span class="line">							_this.portrait_temp = res2.tempFilePath;</span><br><span class="line">						&#125; else if (target == &apos;goods&apos;) &#123;</span><br><span class="line">							console.log(&apos;商品封面：&apos; + res2.tempFilePath)</span><br><span class="line">							_this.goods_temp = res2.tempFilePath;</span><br><span class="line">						&#125;</span><br><span class="line">						if (func) &#123;</span><br><span class="line">							func()</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;)</span><br><span class="line">			&#125;</span><br></pre></td></tr></table></figure>
<h4 id="canvas绘制海"><a href="#canvas绘制海" class="headerlink" title="canvas绘制海"></a>canvas绘制海</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.createOffscreenCanvas.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.createOffscreenCanvas.html</a></p>
<p>canvasToTempFilePath()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">wx.canvasToTempFilePath(Object object, Object this)</span><br><span class="line">把当前画布指定区域的内容导出生成指定大小的图片。在 draw() 回调里调用该方法才能保证图片导出成功。</span><br><span class="line"></span><br><span class="line">示例代码</span><br><span class="line">wx.canvasToTempFilePath(&#123;</span><br><span class="line">  x: 100,</span><br><span class="line">  y: 200,</span><br><span class="line">  width: 50,</span><br><span class="line">  height: 50,</span><br><span class="line">  destWidth: 100,</span><br><span class="line">  destHeight: 100,</span><br><span class="line">  canvasId: &apos;myCanvas&apos;,</span><br><span class="line">  success(res) &#123;</span><br><span class="line">    console.log(res.tempFilePath)</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>关键源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">			 * 绘制海报</span><br><span class="line">			 */</span><br><span class="line">			drawImage() &#123;</span><br><span class="line">				//绘制canvas图片</span><br><span class="line">				var _this = this</span><br><span class="line">				</span><br><span class="line">				var bgPath = &apos;/static/image/banner_index.png&apos;</span><br><span class="line">				var portraitPath = _this.portrait_temp</span><br><span class="line">				var goodsPath = _this.goods_temp</span><br><span class="line">				var qrPath = _this.qrcode_temp</span><br><span class="line">				var hostNickname = &apos;test&apos;</span><br><span class="line">				</span><br><span class="line">				var scale = _this.scale</span><br><span class="line">				var windowWidth = _this.screenWidth</span><br><span class="line">				var windowHeight = _this.windowHeight</span><br><span class="line">				</span><br><span class="line">				var product_price = _this.detail.product_price;</span><br><span class="line">				var product_name = _this.detail.product_name;</span><br><span class="line">			</span><br><span class="line">				// // 绘制头像</span><br><span class="line">				// ctx.save()</span><br><span class="line">				// ctx.beginPath()</span><br><span class="line">				// ctx.arc(25, 25, 25, 0, 2 * Math.PI)</span><br><span class="line">				// ctx.clip()</span><br><span class="line">				// ctx.drawImage(portraitPath, 0, 0, 50, 50)</span><br><span class="line">				// ctx.restore()</span><br><span class="line">				</span><br><span class="line">				const ctx = wx.createCanvasContext(&apos;myCanvas&apos;)	</span><br><span class="line">				ctx.setFillStyle(&apos;#ffffff&apos;);</span><br><span class="line">				ctx.fillRect(0,0,windowWidth,windowHeight);</span><br><span class="line">				</span><br><span class="line">				// 绘制商品图</span><br><span class="line">				ctx.drawImage(goodsPath, 0, 300 * scale, 375 * scale, 375 * scale, 15 * scale, 45 * scale, 345 * scale, 345 * scale);</span><br><span class="line">			</span><br><span class="line">				// 绘制</span><br><span class="line">				ctx.setFillStyle(&apos;#333333&apos;);</span><br><span class="line">				ctx.setFontSize(18 * scale)</span><br><span class="line">				ctx.fillText(product_name, 15 * scale, 445 * scale)</span><br><span class="line">				</span><br><span class="line">				ctx.setFillStyle(&apos;red&apos;);</span><br><span class="line">				ctx.setFontSize(22 * scale)</span><br><span class="line">				ctx.fillText(&apos;￥&apos;+product_price, 15 * scale, 565 * scale)</span><br><span class="line">				</span><br><span class="line">				ctx.setFillStyle(&apos;#9a9a9a&apos;);</span><br><span class="line">				ctx.setFontSize(12 * scale)</span><br><span class="line">				ctx.fillText(&apos;扫描或长按小程序码&apos;, 250 * scale, 620 * scale)</span><br><span class="line">				</span><br><span class="line">				// 绘制二维码</span><br><span class="line">				ctx.drawImage(qrPath, 260 * scale, 520 * scale, 80 * scale, 80 * scale)</span><br><span class="line">				</span><br><span class="line">				ctx.draw(true, function()&#123;</span><br><span class="line">					 wx.canvasToTempFilePath(&#123;</span><br><span class="line">					 	x: 0,</span><br><span class="line">					 	y: 0,</span><br><span class="line">					 	width: _this.windowWidth,</span><br><span class="line">					 	height: _this.windowWidth ,</span><br><span class="line">					 	destWidth: _this.windowWidth * 4,</span><br><span class="line">					 	destHeight: _this.windowWidth * 4,</span><br><span class="line">					 	canvasId: &apos;myCanvas&apos;,</span><br><span class="line">					 	success: function(res) &#123;</span><br><span class="line">					 		 _this.tempFilePath = res.tempFilePath;</span><br><span class="line">					 	&#125;,</span><br><span class="line">					 	fail: function(err) &#123;</span><br><span class="line">					 		uni.hideLoading();</span><br><span class="line">					 		console.log(&apos;失败&apos;)</span><br><span class="line">					 		console.log(err)</span><br><span class="line">					 	&#125;</span><br><span class="line">					 &#125;)</span><br><span class="line">				 &#125;);</span><br><span class="line">			</span><br><span class="line">				return;</span><br><span class="line">			&#125;,</span><br></pre></td></tr></table></figure>
<p>wx.canvasToTempFilePath()必须在ctx.draw()执行完之后才能调用。</p>
<p>获得海报本地临时路径后，可以直接在image标签中使用，弹窗展示海报预览图。</p>
<h4 id="点击保存海报到本地"><a href="#点击保存海报到本地" class="headerlink" title="点击保存海报到本地"></a>点击保存海报到本地</h4><p>wx.saveImageToPhotosAlbum()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wx.saveImageToPhotosAlbum(Object object)</span><br><span class="line">基础库 1.2.0 开始支持，低版本需做兼容处理。</span><br><span class="line">调用前需要 用户授权 scope.writePhotosAlbum</span><br><span class="line">保存图片到系统相册。</span><br><span class="line"></span><br><span class="line">示例代码</span><br><span class="line">wx.saveImageToPhotosAlbum(&#123;</span><br><span class="line">  success(res) &#123; &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">			 * 保存为文件</span><br><span class="line">			 */</span><br><span class="line">			canvasToImage()&#123;</span><br><span class="line">				var _this = this</span><br><span class="line">				uni.showLoading(&#123;</span><br><span class="line">				    title: &apos;正在保存...&apos;</span><br><span class="line">				&#125;);</span><br><span class="line">				setTimeout(function()&#123;</span><br><span class="line">					wx.saveImageToPhotosAlbum(&#123;</span><br><span class="line">						filePath: _this.tempFilePath,</span><br><span class="line">					 &#125;)</span><br><span class="line">					 uni.hideLoading();</span><br><span class="line">					 _this.popupShow = false;</span><br><span class="line">				&#125;, 1000);</span><br><span class="line">			&#125;,</span><br></pre></td></tr></table></figure>
<p>成品如下：</p>
<p><img src="/Users/magicyou/Desktop/WechatIMG131.jpeg" alt="WechatIMG131"></p>
</div><div class="tags"><a href="/tags/JavaScript/">JavaScript</a><a href="/tags/微信小程序/">微信小程序</a><a href="/tags/uni-app/">uni-app</a></div><div class="post-nav"><a class="pre" href="/2019/07/03/PHP获取微信小程序码/">微信小程序---PHP获取微信小程序码</a><a class="next" href="/2019/02/24/单点登录配置 记录/">配置webgate拦截跳转到ldap登录页实现单点登录</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="https://blog.magicyou.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/MacOS/">MacOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PHP/">PHP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端/">前端</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/CSS3/" style="font-size: 15px;">CSS3</a> <a href="/tags/Vue/" style="font-size: 15px;">Vue</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/Python/" style="font-size: 15px;">Python</a> <a href="/tags/微信小程序/" style="font-size: 15px;">微信小程序</a> <a href="/tags/Centos/" style="font-size: 15px;">Centos</a> <a href="/tags/other/" style="font-size: 15px;">other</a> <a href="/tags/jQuery/" style="font-size: 15px;">jQuery</a> <a href="/tags/scrapy/" style="font-size: 15px;">scrapy</a> <a href="/tags/HTML5/" style="font-size: 15px;">HTML5</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/Apache/" style="font-size: 15px;">Apache</a> <a href="/tags/MacOS/" style="font-size: 15px;">MacOS</a> <a href="/tags/CSS/" style="font-size: 15px;">CSS</a> <a href="/tags/HTML/" style="font-size: 15px;">HTML</a> <a href="/tags/uni-app/" style="font-size: 15px;">uni-app</a> <a href="/tags/微信小程序/" style="font-size: 15px;">微信小程序'</a> <a href="/tags/canvas/" style="font-size: 15px;">canvas</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/09/03/环形温度调节实现/">环形温度调节实现</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/08/03/ vue-组件封装中之slot插槽使用/">vue---组件封装中之slot插槽使用</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/03/PHP获取微信小程序码/">微信小程序---PHP获取微信小程序码</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/03/微信小程序合成海报/">微信小程序---合成海报分享到朋友圈</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/24/单点登录配置 记录/">配置webgate拦截跳转到ldap登录页实现单点登录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/23/一次环境升级记录/">一次lnmp环境升级记录</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/02/03/yum源的代理设置及修改/">yum源的代理设置及修改</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/23/脚本微博登录自动发微博并返回cookie/">脚本微博登录自动发微博并返回cookie</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/10/scrapy爬虫之初次尝试/">scrapy爬虫之初次尝试</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/26/安装python的crypto模块/">安装python的crypto模块</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://hexo.io" title="Hexo" target="_blank">Hexo</a><ul></ul><a href="http://moxfive.xyz/" title="MOxFIVE" target="_blank">MOxFIVE</a><ul></ul><a href="https://coolshell.cn/" title="左耳朵耗子的酷壳" target="_blank">左耳朵耗子的酷壳</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">MagicYou.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.3.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.3.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.3.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.3.0"></script></div></body></html>